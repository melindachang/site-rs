---
import BaseLayout from '../../layouts/BaseLayout.astro'
import CheckersSvg from '../../assets/CheckersSvg.svelte'

import type { APIContext } from 'astro'
import { getCollection } from 'astro:content'
import { emphasizePreps, formatRawDate } from '../../utils/utils'

export async function getStaticPaths() {
  const notes = await getCollection('notes')
  return notes.map(note => ({ params: { slug: note.slug }, props: { note } }))
}

const { note } = Astro.props
const { Content } = await note.render()
---

<BaseLayout showScrollProgress>
  <div class="wrapper">
    <div class="appendix"></div>
    <article class="note">
      <div class="note__meta">
        <div class="note__meta__info">
          <span style="margin-top: 2px"><CheckersSvg /></span>
          <span
            >{note.data.tags.join(' // ')}<br />{
              formatRawDate(note.data.date)
            }</span
          >
        </div>
        <div class="note__meta__author">Written by <br /> Melinda CHang</div>
      </div>
      <!-- <h1 class="note__title" set:html={emphasizePreps(note.data.title)} /> -->
      <h1 class="note__title">{note.data.title}</h1>
      <div class="note__body">
        <Content />
      </div>
    </article>
  </div>
</BaseLayout>

<style lang="scss">
  .wrapper {
    display: grid;
    grid-template-columns: 1fr 1fr;
    position: relative;
    min-height: 100vh;

    & > * {
      overflow: hidden;
      min-width: 0;

      &:first-child {
        padding-right: 3.6rem;
        padding-left: 1.8rem;
      }
      &:last-child {
        padding-right: 1.8rem;
        padding-left: 3.6rem;
      }
    }

    &::before {
      content: '';
      position: absolute;
      height: 100%;
      left: 50%;
      border-left: 1px solid var(--clr-primary);
      opacity: 0.2;
    }

    &::after {
      content: '';
      position: absolute;
      left: calc(50% - 16px);
      top: 0;
      width: 32px;
      height: 100%;
      border-left: 1px dashed rgba(63, 64, 61, 0.2);
      border-right: 1px dashed rgba(63, 64, 61, 0.2);
    }
  }

  .note {
    &__title {
      width: 65%;
      font-family: var(--font-title);
      font-size: calc(40.988px + 0.753012svw);
      line-height: 0.95;
      letter-spacing: -0.03em;
      margin: 10rem 0 0;
      padding-bottom: 4rem;
    }

    &__meta {
      display: flex;
      justify-content: space-between;
      text-transform: uppercase;
      font-size: 1.3rem;
      font-family: var(--font-monospace);
      &__info {
        display: flex;
        gap: 3.2rem;

        span {
          line-height: 1.4;
        }
      }

      &__author {
        text-align: right;
        text-decoration: underline;
      }
    }
  }
</style>
